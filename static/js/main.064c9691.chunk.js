(("undefined"!==typeof self?self:this).webpackJsonp=("undefined"!==typeof self?self:this).webpackJsonp||[]).push([[0],{187:function(e,t,a){e.exports=function(){return new Worker(a.p+"30a1e758381a83b63b53.worker.js")}},237:function(e,t,a){a(238),e.exports=a(396)},254:function(e,t,a){},377:function(e,t,a){},382:function(e,t,a){},392:function(e,t,a){},395:function(e,t,a){},396:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(16),o=a.n(i),s=a(193),l=a(5),c=a(7),u=a(12),d=a(11),h=a(13),m=a(184),f=a.n(m),p=a(6),b=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:24,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:101325;Object(l.a)(this,e),this.temperature=void 0,this.relativeHumidity=void 0,this.pressure=void 0,this.temperatureK=void 0,this.relativePressure=void 0,this.cHumid=void 0,this.hum=void 0,this.relativeTemperature=void 0,this.frO=void 0,this.frN=void 0,this.temperature=t,this.relativeHumidity=a,this.pressure=r,this.temperatureK=t+273.15,this.relativePressure=r/101325,this.cHumid=4.6151-6.8346*Math.pow(273.15/this.temperatureK,1.261),this.hum=this.relativeHumidity*Math.pow(10,this.cHumid)*this.relativePressure,this.relativeTemperature=this.temperatureK/293.15,this.frO=this.relativePressure*(24+40400*this.hum*(.02+this.hum)/(.391+this.hum)),this.frN=this.relativePressure*Math.pow(this.relativeTemperature,-.5)*(9+280*this.hum*Math.exp(-4.17*(Math.pow(this.relativeTemperature,-1/3)-1)))}return Object(c.a)(e,[{key:"get",value:function(e){return 8.686*e*e*(1/this.relativePressure*1.84e-11*Math.sqrt(this.relativeTemperature)+Math.pow(this.relativeTemperature,-2.5)*(1*Math.exp(-2239.1/this.temperatureK)/(this.frO+e*e/this.frO)*.01275+1*Math.exp(-3352/this.temperatureK)/(this.frN+e*e/this.frN)*.1068))}}]),e}(),v=a(93),y=function(){function e(t){Object(l.a)(this,e),this.map=t}return Object(c.a)(e,[{key:"get",value:function(e){return this.map[e]}},{key:"frequencies",get:function(){return Object.keys(this.map).map(function(e){return+e})}},{key:"values",get:function(){return Object.values(this.map)}}]),e}(),g=[125,250,500,1e3,2e3,4e3],w=[63].concat(g,[8e3]);[].concat(Object(v.a)(w),[16e3]);function E(e){if(6!==e.length)throw new Error("Array must be of size 6");return new y({125:e[0],250:e[1],500:e[2],1000:e[3],2000:e[4],4000:e[5]})}var S=function(e){function t(e,a,r,n){var i;return Object(l.a)(this,t),(i=Object(u.a)(this,Object(d.a)(t).call(this,{color:n,flatShading:!0,vertexColors:p.VertexColors}))).name=e,i.absorption=a,i.scatter=r,i}return Object(h.a)(t,e),t}(p.MeshPhongMaterial),j=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,null,[{key:"addMaterial",value:function(t,a,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.random();e.materials[t]=new S(t,a,r,n)}},{key:"getMaterial",value:function(t){var a=e.materials[t];return void 0!==a?a:(console.warn("Unknown material.",t,"Creating one with abs 1% scatter 10%"),a=new S(t,E([1,1,1,1,1,1]),E([10,10,10,10,10,10]),16777215*Math.random()),e.materials[t]=a,a)}}]),e}();j.materials={ceramic:new S("ceramic",E([1,1,1,2,2,2]),E([10,10,10,10,10,10]),13421772),concrete:new S("concrete",E([1,1,2,2,2,5]),E([10,10,10,10,10,10]),10066329),metal140cavity:new S("metal140cavity",E([13,11,6,5,4,4]),E([10,10,10,10,10,10]),11184810),plasterboard140cavity:new S("plasterboard140cavity",E([5,1,6,4,9,1]),E([10,10,10,10,10,10]),14540253),plasterboard15cavity:new S("plasterboard15cavity",E([11,13,5,2,2,3]),E([10,10,10,10,10,10]),14540253),window:new S("window",E([10,4,3,2,2,2]),E([10,10,10,10,10,10]),5592524),sonaspray:new S("sonaspray",E([26,62,102,107,101,93]),E([10,10,10,10,10,10]),5592524),fullabsorp:new S("test",E([100,35,45,59,100,70]),E([10,10,10,10,10,10]),1118481)};for(var O=0;O<0;O++)j.addMaterial("test-"+Math.round(1e7*Math.random()),E([100*Math.random(),100*Math.random(),100*Math.random(),100*Math.random(),100*Math.random(),100*Math.random()]),E([100*Math.random(),100*Math.random(),100*Math.random(),100*Math.random(),100*Math.random(),100*Math.random()]));var x=16,k=function(){function e(t){if(Object(l.a)(this,e),this.hits=0,this.readIndex=0,this.dataView=void 0,t.byteLength%x!==0)throw new Error("Buffer length must be multiples of REFLECTOGRAM_SIZE' ".concat(x));this.dataView=new DataView(t)}return Object(c.a)(e,[{key:"getReflection",value:function(e){return{distance:this.getDistance(e),p2:this.getP2(e),frequency:this.getFrequency(e),rayId:this.getRayId(e)}}},{key:"appendReflection",value:function(e){var t=this.hits*x;return this.dataView.setFloat32(t,e.distance,!0),this.dataView.setFloat32(t+4,e.p2,!0),this.dataView.setInt32(t+8,e.frequency,!0),this.dataView.setInt32(t+12,e.rayId,!0),this.hits++}},{key:"next",value:function(e){for(var t=[],a=this.readIndex,r=this.readIndex+e;a<r;a++)t.push(this.getReflection(a));return this.readIndex+=e,t}},{key:"getDistance",value:function(e){var t=e*x;return this.dataView.getFloat32(t,!0)}},{key:"getP2",value:function(e){var t=e*x;return this.dataView.getFloat32(t+4,!0)}},{key:"getFrequency",value:function(e){var t=e*x;return this.dataView.getInt32(t+8,!0)}},{key:"getRayId",value:function(e){var t=e*x;return this.dataView.getInt32(t+4,!0)}}]),e}(),M=1e5,C=function(e){function t(e,a,r){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,a,r))).name=void 0,n.id=void 0,n.enabled=!0,n.sharedBuffer=void 0,n.bufferView=void 0,n.id=t.id++,n.name=e,n.sharedBuffer=new SharedArrayBuffer(x*M),n.bufferView=new k(n.sharedBuffer),n}return Object(h.a)(t,e),Object(c.a)(t,[{key:"addReflection",value:function(e){return this.bufferView.appendReflection(e)}},{key:"hits",value:function(){return this.bufferView.hits}}]),t}(p.Sphere);C.id=0;var R=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,null,[{key:"dbSPL2Pa",value:function(e){return 2e-5*Math.pow(10,e/20)}},{key:"P2dbSPL",value:function(e){return 20*Math.log10(e/2e-5)}},{key:"P22dbSPL",value:function(t){return e.P2dbSPL(Math.sqrt(t))}}]),e}(),I=!0,D=4*Float32Array.BYTES_PER_ELEMENT,P=60,L=function(){function e(t){Object(l.a)(this,e),this.sharedBuffer=void 0,this.math=new p.Ray,this.vertices=void 0,this.stateDV=void 0;var a=null;if(t instanceof SharedArrayBuffer?this.sharedBuffer=t:(a=t,this.sharedBuffer=e.alloc(a.orderLimit)),(this.sharedBuffer.byteLength-P)%D!==0)throw new Error("Invalid buffer size ".concat(this.sharedBuffer.byteLength,". Must be 'n * ").concat(D," + ").concat(P));this.stateDV=new DataView(this.sharedBuffer,this.sharedBuffer.byteLength-P,P),this.vertices=new Float32Array(this.sharedBuffer,0,(this.sharedBuffer.byteLength-P)/Float32Array.BYTES_PER_ELEMENT),null!==a?(this.frequency=a.frequency,this.stateDV.setInt32(28,a.orderLimit,I),this.stateDV.setInt32(32,a.dbSPL,I),this.alive=!0,this.totalDistance=0,this.order=0,this.currentP2=this.initialP2=Math.pow(R.dbSPL2Pa(this.dbSPL),2),this.setRay(a.origin,a.direction),this.stateDV.setInt32(52,e.counter++,I),this.vertices[0]=a.origin.x,this.vertices[1]=a.origin.y,this.vertices[2]=a.origin.z):(this.math.origin.set(this.stateDV.getFloat32(16,I),this.stateDV.getFloat32(20,I),this.stateDV.getFloat32(24,I)),this.math.direction.set(this.stateDV.getFloat32(4,I),this.stateDV.getFloat32(8,I),this.stateDV.getFloat32(12,I)))}return Object(c.a)(e,null,[{key:"alloc",value:function(e){return new SharedArrayBuffer(e*D+P)}}]),Object(c.a)(e,[{key:"setRay",value:function(e,t){this.stateDV.setFloat32(16,e.x,I),this.stateDV.setFloat32(20,e.y,I),this.stateDV.setFloat32(24,e.z,I),this.stateDV.setFloat32(4,t.x,I),this.stateDV.setFloat32(8,t.y,I),this.stateDV.setFloat32(12,t.z,I),this.math.set(e,t)}},{key:"frequency",get:function(){return this.stateDV.getInt32(0,I)},set:function(e){this.stateDV.setInt32(0,e,I)}},{key:"orderLimit",get:function(){return this.stateDV.getInt32(28,I)}},{key:"dbSPL",get:function(){return this.stateDV.getInt32(32,I)}},{key:"currentP2",get:function(){return this.stateDV.getFloat32(36,I)},set:function(e){this.stateDV.setFloat32(36,e,I)}},{key:"order",get:function(){return this.stateDV.getInt32(40,I)},set:function(e){this.stateDV.setInt32(40,e,I)}},{key:"totalDistance",get:function(){return this.stateDV.getFloat32(44,I)},set:function(e){this.stateDV.setFloat32(44,e,I)}},{key:"initialP2",get:function(){return this.stateDV.getFloat32(48,I)},set:function(e){this.stateDV.setFloat32(48,e,I)}},{key:"id",get:function(){return this.stateDV.getInt32(52,I)}},{key:"alive",get:function(){return 0!==this.stateDV.getInt32(56,I)},set:function(e){this.stateDV.setInt32(56,e?1:0,I)}}]),e}();L.counter=0;var A,V=Math.pow(2e-5,2),T=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"reflect",value:function(e,t,a,r){var n=this.currentP2;if(!this.checkPulse())return n;var i=this.order+1,o=this.math.origin.distanceTo(e);this.totalDistance+=o,this.vertices[4*i+0]=e.x,this.vertices[4*i+1]=e.y,this.vertices[4*i+2]=e.z,this.vertices[4*i+3]=t.id;var s=r.get(this.frequency)*o;n/=Math.pow(10,s/10),n*=1-t.material.absorption.get(this.frequency)/100,this.currentP2=n;var l=this.math.direction.reflect(a);return this.scatter(l,t.material,a),this.setRay(e,l),this.order=i,this.currentP2}},{key:"meanFreePath",value:function(){return this.totalDistance/this.order}},{key:"scatter",value:function(e,t,a){var r=t.scatter.get(this.frequency);if(void 0!==r){var n=e.clone();r/=50,n.x+=Math.random()*r-r/2,n.y+=Math.random()*r-r/2,n.z+=Math.random()*r-r/2,n.normalize(),n.dot(a)>0?e.copy(n):this.scatter(e,t,a)}else console.warn("Unknown scatter band for the ray",this.frequency)}},{key:"checkPulse",value:function(){return!!this.alive&&(this.order>this.orderLimit?this.alive=!1:!(this.currentP2<V)||(this.alive=!1))}}]),t}(L),B=function(){function e(t,a){Object(l.a)(this,e),this.name=t,this.position=a,this.enabled=!0,this.name=t,this.position=a}return Object(c.a)(e,[{key:"emit",value:function(e){var t={direction:this.randomDirection(),frequency:this.randomFrequency(e),origin:this.position.clone(),dbSPL:100,orderLimit:1e3};return new T(t)}},{key:"randomFrequency",value:function(e){return e[Math.floor(Math.random()*e.length)]}},{key:"randomDirection",value:function(){return new p.Vector3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1).normalize()}}]),e}(),N=function(e){function t(e,a,r){var n,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Object(l.a)(this,t),(n=Object(u.a)(this,Object(d.a)(t).call(this,a,r))).isFloor=i,n.sid=void 0,n.isAcousticSurface=!0,n.sid=e,a.computeFaceNormals(),a.computeBoundingBox(),n}return Object(h.a)(t,e),t}(p.Mesh),z={3:new(function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,[{key:"load",value:function(e,t){var a=e;if(3!==e.version)throw console.error("Loader v3 is used for file with version",e.version),new Error("Loader version mismatch");t.modelInit();for(var r=[],n=[],i=[],o=0,s=a.surfaces.length;o<s;o++){for(var l=new p.Geometry,c=a.surfaces[o],u=0,d=c.vertices.length;u<d;u++){var h=c.vertices[u];l.vertices.push(new p.Vector3(h[0],h[1],h[2]))}for(var m=0,f=c.faces.length;m<f;m++){var b=c.faces[m];l.faces.push(new p.Face3(b[2],b[1],b[0]))}var v=c.material.split("$"),y=!1,g=v[0];2===v.length&&(y="floor"===v[1]);var w=new N(o,l,j.getMaterial(g),y);r.push(w),t.addSurface(w)}for(var E=0,S=a.receivers.length;E<S;E++){var O=a.receivers[E],x=O.position,k=new C(O.name,new p.Vector3(x[0],x[1],x[2]),.5);n.push(k),t.addReceiver(k)}for(var M=0,R=a.sources.length;M<R;M++){var I=a.sources[M],D=I.position,P=new B(I.name,new p.Vector3(D[0],D[1],D[2]));i.push(P),t.addSource(P)}return t.modelDone(),{surfaces:r,receivers:n,sources:i}}},{key:"getVertices",value:function(e){return[]}}]),e}())},F=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,null,[{key:"load",value:function(e,t){var a=z[e.version];if(void 0===a)throw console.error("I don't have any loader for model file version: ",e.version),new Error("No loader for file version");return a.load(e,t)}}]),e}(),G=function(){function e(t){if(Object(l.a)(this,e),this.incremental={},this.receiversNames=[],this.buffers=[],this.receivers={},0!==t.length){this.buffers=t,this.receiversNames=Object.keys(t[0]);for(var a=0,r=t.length;a<r;a++)for(var n=t[a],i=0,o=this.receiversNames.length;i<o;i++){var s=this.receiversNames[i];void 0===this.receivers[s]&&(this.receivers[s]=[],this.incremental[s]=[]);var c=new k(n[s]);this.receivers[s].push(c)}}}return Object(c.a)(e,[{key:"generate",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return!0},r=this.receivers[e];if(void 0===r)return console.warn("Unknown receiver"),[];for(var n=[],i=0,o=r.length;i<o;i++)for(var s=r[i],l=0;l<M;l++){var c=s.getReflection(l);if(0===c.distance)break;!1!==a(c)&&n.push(t(c))}return n}},{key:"accumulate",value:function(e){}},{key:"diff",value:function(e){if(0===e.length)return{};for(var t={},a=Object.keys(e[0]),r=0,n=a.length;r<n;r++)t[a[r]]=[];for(var i=0,o=e.length;i<o;i++)for(var s=e[i],l=0,c=a.length;l<c;l++){var u,d=a[l],h=s[d],m=this.receivers[d];if(void 0===m)return console.error("No reflectogram viewer for the diff map"),{};var f=m[i];(u=t[d]).push.apply(u,Object(v.a)(f.next(h)))}return t}}]),e}(),W=a(185),H=a(186),q=a.n(H),U=a(187),J=a.n(U);!function(e){e.LoadModel="LoadModel",e.SetEnvironment="SetEnvironment",e.Clear="Clear",e.Excite="Excite",e.Iterate="Iterate",e.Run="Run",e.Init="Init"}(A||(A={}));var _=function(){function e(){Object(l.a)(this,e),this.threads=[],this.rays=[],this.excited=!1,this.order=0,this.model=void 0;for(var t=0,a=navigator.hardwareConcurrency;t<a;t++){var r=new q.a(new J.a);this.threads.push(r),r.postMessage({command:A.Init,threadId:t})}}return Object(c.a)(e,[{key:"setEnvironment",value:function(e,t){this.sendCommand({command:A.SetEnvironment,humidity:t,temperature:e})}},{key:"clearRays",value:function(){this.sendCommand({command:A.Clear})}},{key:"excite",value:function(e,t){var a=this,r=Math.floor(t/this.threads.length);return this.sendCommand({command:A.Excite,numberOfRays:r,source:e}).then(function(e){for(var t=e.replies,r=t[0].rays,n=[t[0].reflectogramsPerRececiver],i=1,o=t.length;i<o;i++)r=r.concat(t[i].rays),n.push(t[i].reflectogramsPerRececiver);return a.excited=!0,a.rays=r,{rays:r,reflectogramsPerThread:n}})}},{key:"iterate",value:function(){var e=this;return this.sendCommand({command:A.Iterate}).then(function(t){for(var a=t.replies,r=a[0],n=r.order,i=[r.hitsDiffPerReceiver],o=!0,s=1,l=a.length;s<l;s++){var c=a[s];if(c.dead||(o=!1),n!==c.order)return console.warn("Mismatched order report from threads.",n,c.order),{command:A.Iterate,success:!1};i.push(c.hitsDiffPerReceiver)}return e.order=n,{command:A.Iterate,dead:o,hitsDiffsPerThread:i,order:n}})}},{key:"run",value:function(e){this.sendCommand({command:A.Excite,iterations:e})}},{key:"loadModel",value:function(e){return this.model=e,this.excited=!1,this.sendCommand({command:A.LoadModel,model:e})}},{key:"sendCommand",value:function(e){for(var t=[],a=0,r=this.threads.length;a<r;a++)t.push(this.postMessage(a,e));return W.Promise.all(t).then(function(e){for(var t=!0,a=0,r=e.length;a<r;a++){return!1===e[a].success&&(t=!1),{replies:e,success:t}}})}},{key:"postMessage",value:function(e,t){return this.threads[e].postMessage(t)}}]),e}(),$=a(121),K=a(18),Y=a(82),X=a(128),Z=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).jobCounter=0,a.state={jobs:[]},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"addJob",value:function(e){var t=this.jobCounter++;return this.setState(function(a,r){var n=a.jobs;return e.id=t,{jobs:n.concat(e)}}),this.forceUpdate(),t}},{key:"updateJob",value:function(e,t){var a=this.state.jobs,r=a.findIndex(function(t){return t.id===e});if(-1!==r){var n=a[r];a[r]=Object.assign(n,t),this.setState({jobs:a}),this.forceUpdate()}else console.warn("JobID does not exist",e)}},{key:"removeJob",value:function(e){var t=this.state.jobs.findIndex(function(t){return t.id===e}),a=[];(a=a.concat(this.state.jobs)).splice(t,1),this.setState({jobs:a}),this.forceUpdate()}},{key:"getJob",value:function(e){var t=this.state.jobs.find(function(t){return t.id===e});if(void 0!==t)return Object.assign({},t)}},{key:"render",value:function(){return n.a.createElement($.a,{position:K.a.BOTTOM_RIGHT},this.state.jobs.map(function(e){return n.a.createElement(Y.a,{timeout:0,key:e.id,message:n.a.createElement(X.a,{value:e.progress})})}))}}]),t}(n.a.PureComponent),Q=a(57),ee=a(182),te=a(42),ae=(a(254),a(95)),re=a(188),ne=a.n(re),ie=a(94),oe=a(36),se=a(85),le=a(88),ce=a(86),ue=(a(256),a(257),a(58)),de=a.n(ue),he=(a(266),a(339),a(348),a(360),a(175),a(15)),me=a.n(he),fe=a(189),pe=a.n(fe),be=a(59),ve=a(69),ye=a(194),ge=(a(377),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={height:400,minimized:!1,top:!1,width:250,x:0,y:0},a.ref=null,a.bringForward=function(){a.setState({top:!0})},a.bringBack=function(){a.setState({top:!1})},a.updateGeometry=function(e){a.setState(e,function(){a.storeGeometry()})},a.closeHandler=function(){void 0!==a.props.onClose&&a.props.onClose()},a.toggleMinimize=function(){a.setState(function(e,t){return{minimized:!e.minimized}})},a.dragHandler=function(e,t){a.updateGeometry({x:t.x,y:t.y})},a.resizeHandler=function(e,t,r,n,i){a.updateGeometry({height:a.state.height+n.height,width:a.state.width+n.width})},a.mouseDown=function(e){e.preventDefault(),t.instances.forEach(function(e){return e.bringBack()}),a.bringForward()},a.mouseMove=function(e){e.stopPropagation()},a.state.width=e.width||400,a.state.height=e.height||200,a.recallGeometry(),t.instances.push(Object(ve.a)(Object(ve.a)(a))),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"componentWillUnmount",value:function(){var e=this;t.instances=t.instances.filter(function(t){return t!==e})}},{key:"render",value:function(){if(void 0!==this.props.isOpen&&!1===this.props.isOpen)return[];var e=this.props,t=e.name,a=e.hideTitleBar,r=(e.isOpen,e.className),i=Object(ae.a)(e,["name","hideTitleBar","isOpen","className"]),o="window-draggable";return void 0!==r&&(o+=" "+r),this.state.minimized&&(o+=" window-minimized"),n.a.createElement(ye.a,Object.assign({onMouseDown:this.mouseDown},i,{style:{zIndex:this.state.top?2:1},className:o,position:{x:this.state.x,y:this.state.y},size:{width:this.state.width,height:this.state.height},onDragStop:this.dragHandler,onResizeStop:this.resizeHandler}),n.a.createElement("div",{className:"bp3-dialog-container bp3-dark ea-compact",onMouseMove:this.mouseMove,style:{alignItems:"inherit"}},n.a.createElement("div",{className:"bp3-dialog",style:{margin:0,width:"100%"}},void 0===a||!1===a?n.a.createElement("div",{className:"bp3-dialog-header window-handle"},n.a.createElement("span",{className:this.getIcon()}),n.a.createElement("h6",{className:"bp3-heading"},t),n.a.createElement("button",{"aria-label":"Minimize",onClick:this.toggleMinimize,className:"bp3-dialog-close-button bp3-button bp3-minimal bp3-icon-minimize"}),n.a.createElement("button",{"aria-label":"Close",onClick:this.closeHandler,className:"bp3-dialog-close-button bp3-button bp3-minimal bp3-icon-cross"})):"",n.a.createElement("div",{className:"bp3-dialog-body",style:{margin:0,overflow:"auto"}},this.props.children))))}},{key:"getIcon",value:function(){var e="bp3-icon-small ";return void 0!==this.props.icon?e+=this.props.icon:e+="bp3-icon-drag-handle-horizontal",e}},{key:"recallGeometry",value:function(){var e=localStorage.getItem("WindowPositions")||"{}",t=JSON.parse(e);void 0===t[this.props.name]&&(t[this.props.name]={height:this.state.height,width:this.state.width,x:this.state.x,y:this.state.y}),Object.assign(this.state,t[this.props.name])}},{key:"storeGeometry",value:function(){var e=localStorage.getItem("WindowPositions")||"{}",t=JSON.parse(e);t[this.props.name]={height:this.state.height,width:this.state.width,x:this.state.x,y:this.state.y},localStorage.setItem("WindowPositions",JSON.stringify(t))}}]),t}(n.a.Component));ge.instances=[],me.a.registerTheme("dark",be);var we=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={options:Ee},console.log("RView init",e),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"getOptions",value:function(){var e=this.createOptionsTemplate();console.log(this.props.data),e.series.push({barWidth:2,data:this.props.data,name:"Reflectogram",type:"bar"});var t=this.props.data.filter(function(e){return 125===e[2]}),a=t.length,r=new Array(a);r[a-1]=[t[a-1][0],t[a-1][1]];for(var n=a-2;n>=0;n--)r[n]=[t[n][0],r[n+1][1]+t[n][1]];var i=r.map(function(e){return[e[0],10*Math.log10(e[1])]}),o=pe.a.linear(i.filter(function(e){return e[1]<28&&e[1]>-2})).equation,s=Object(ie.a)(o,2),l=s[0],c=s[1];console.log("lg",l,c);var u=c,d=6*l+c;return console.log("T30",(u-60-c)/l),e.series.push({data:i,name:"Schroeder",sampling:"average",type:"line"}),e.series.push({data:[[0,u],[6,d]],name:"Linear Regression",type:"line"}),e.series[0].data=e.series[0].data.map(function(e){return[e[0],R.P22dbSPL(e[1])]}),e}},{key:"render",value:function(){return console.log("RV render"),n.a.createElement(ge,Object.assign({name:"Reflectogram Viewer",dragHandleClassName:"bp3-dialog-header",width:700},this.props),n.a.createElement(Q.a,{style:{minWidth:200}},n.a.createElement(te.b,{icon:"floppy-disk",title:"Save"}),n.a.createElement(te.b,{icon:"folder-open",title:"load"}),n.a.createElement(te.b,{icon:"timeline-area-chart",title:"Schroeder"}),n.a.createElement(oe.a,{position:K.a.BOTTOM_LEFT,boundary:"window",content:n.a.createElement(se.a,null,n.a.createElement(le.a,{text:"New",icon:"document"}),n.a.createElement(le.a,{text:"Open",icon:"folder-shared"}),n.a.createElement(le.a,{text:"Close",icon:"add-to-folder"}),n.a.createElement(ce.a,null),n.a.createElement(le.a,{text:"Save",icon:"floppy-disk"}),n.a.createElement(le.a,{text:"Save as...",icon:"floppy-disk"}),n.a.createElement(ce.a,null),n.a.createElement(le.a,{text:"Exit",icon:"cross"}))},n.a.createElement(te.b,{rightIcon:"caret-down",icon:"timeline-area-chart",text:"hello"}))),n.a.createElement(de.a,{echarts:me.a,option:this.getOptions(),theme:"dark",style:{width:"100%",height:"100%"}}))}},{key:"createOptionsTemplate",value:function(){return Object.assign({},Ee)}}]),t}(n.a.PureComponent),Ee={dataZoom:[{type:"inside"},{type:"slider"}],grid:{bottom:50},legend:{show:!0},series:[],tooltip:{axisPointer:{type:"shadow"},trigger:"axis"},xAxis:{silent:!1,splitArea:{show:!1},splitLine:{show:!1}},yAxis:{splitArea:{show:!1}}},Se=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).reflectogramId=0,a.openReflectogram=function(e){a.setState(function(t){return{openedReflectograms:[{key:a.reflectogramId++,name:e}].concat(t.openedReflectograms)}})},a.closeReflectogram=function(e){console.log("Closing",e),a.setState(function(t){return{openedReflectograms:t.openedReflectograms.filter(function(t){return t.key!==e})}})},a.state={openedReflectograms:[]},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.simulationStats,r=Object(ae.a)(t,["simulationStats"]),i=a;if(void 0===i)return[];for(var o=i.model,s=i.rays,l=0,c=0,u=s.length;c<u;c++){var d=s[c];l+=new T(d).meanFreePath()}var h=l/s.length;return console.log("mfp",h),[n.a.createElement(ge,Object.assign({key:"dafaq"},r),n.a.createElement("div",{className:"bp3-dialog-body"},n.a.createElement("table",{className:"bp3-html-table bp3-html-table-bordered bp3-html-table-condensed bp3-html-table-striped bp3-small"},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Metric"),n.a.createElement("th",null,"Value"))),n.a.createElement("tbody",null,n.a.createElement("tr",null,n.a.createElement("td",null,"Number of rays:"),n.a.createElement("td",null,i.rays.length)),n.a.createElement("tr",null,n.a.createElement("td",null,"Surfaces"),n.a.createElement("td",null,o.surfaces.length)),n.a.createElement("tr",null,n.a.createElement("td",null,"Faces"),n.a.createElement("td",null,o.surfaces.reduce(function(e,t){return e+t.faces.length},0))),n.a.createElement("tr",null,n.a.createElement("td",null,"Volume"),n.a.createElement("td",null)),n.a.createElement("tr",null,n.a.createElement("td",null,"Surfrace area"),n.a.createElement("td",null)),n.a.createElement("tr",null,n.a.createElement("td",null,"Mean free path"),n.a.createElement("td",null,h)),n.a.createElement("tr",null,n.a.createElement("td",null,"Receivers"),n.a.createElement("td",null,o.receivers.length)),n.a.createElement("tr",null,n.a.createElement("td",null,"Sources"),n.a.createElement("td",null,o.sources.length)),n.a.createElement("tr",null,n.a.createElement("td",null,"Order"),n.a.createElement("td",null,i.iterations,n.a.createElement("span",{className:"bp3-text-small bp3-text-muted"},"(",Math.round(i.iterations/i.elapsed*1e3)," iteration/sec)"))),n.a.createElement("tr",null,n.a.createElement("td",null,"Time it took:"),n.a.createElement("td",null,(i.elapsed/1e3).toFixed(2),"s")),n.a.createElement("tr",null,n.a.createElement("td",null,"Receiver stats"),n.a.createElement("td",null,ne.a.pairs(i.receiverStats).map(function(t){return n.a.createElement("button",{key:t[0],onClick:function(){return e.openReflectogram(t[0])}},t[0]," (",t[1],")")}))))))),this.reflectograms()]}},{key:"reflectograms",value:function(){var e=this,t=this.props.simulationStats.reflectogramAggregator;return this.state.openedReflectograms.map(function(a){var r=t.generate(a.name,function(e){return[e.distance/343,e.p2,e.frequency]}).sort(function(e,t){return e[0]-t[0]});return n.a.createElement(we,{key:a.key,name:a.name,data:r,onClose:function(){return e.closeReflectogram(a.key)}})})}}]),t}(n.a.PureComponent),je=function(){function e(t,a,r){var n=this;Object(l.a)(this,e),this.rays=[],this.iterations=0,this.model=void 0,this.reflectogramAggregator=void 0,this.receiverStats={},this.elapsed=-1,this.timeStart=0,this.timeEnd=0,this.rays=t,this.reflectogramAggregator=a,this.model=r,a.receiversNames.forEach(function(e){return n.receiverStats[e]=0})}return Object(c.a)(e,[{key:"update",value:function(e){var t=this;this.iterations++;for(var a=function(a,r){var n=e[a];Object.keys(n).forEach(function(e){t.receiverStats[e]+=n[e]})},r=0,n=e.length;r<n;r++)a(r)}},{key:"start",value:function(){this.timeStart=performance.now()}},{key:"stop",value:function(){this.timeEnd=performance.now(),this.elapsed=this.timeEnd-this.timeStart}}]),e}(),Oe=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).cancelSimulation=!1,a.jobId=-1,a.simulationStats=void 0,a.raysSAB=[],a.rayGroup=new p.Group,a.rayGeometries=[],a.iterate=function(){return a.props.tracerMaster.iterate().then(function(e){return e})},a.excite=function(){if(void 0===a.props.tracerMaster.model)return console.log("Model not loaded to tracer"),Promise.reject("Model not loaded");var e=a.props.jobs.addJob({name:"Exciting the space",progress:0,total:1});return a.props.tracerMaster.excite("S2",a.state.rays).then(function(t){a.initRays(t.rays),a.simulationStats=new je(t.rays,new G(t.reflectogramsPerThread),a.props.tracerMaster.model),a.props.jobs.removeJob(e),console.log("excite result",t)})},a.run=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=a.simulationStats;0===t&&(a.jobId=a.props.jobs.addJob({name:"test",id:-1,progress:0,total:e}),r.start());var n=a.props.jobs.getJob(a.jobId);return void 0!==n&&a.props.jobs.updateJob(a.jobId,{progress:t/n.total}),a.iterate().then(function(n){t+=1;for(var i=0,o=a.rayGeometries.length;i<o;i++){var s=a.rayGeometries[i];s.setDrawRange(0,t),s.attributes.position.needsUpdate=!0}return r.update(n.hitsDiffsPerThread),!n.dead&&t<e&&!a.cancelSimulation?a.run(e,t):(r.stop(),a.setState({showResults:!0,simulationStats:r,pauseDisabled:!0,playDisabled:!1,stopDisabled:!1}),a.props.jobs.removeJob(a.jobId),console.log("result",n),n)})},a.play=function(){a.setState({pauseDisabled:!1,playDisabled:!0,stopDisabled:!0}),a.excite().then(function(){return a.run(1e3)})},a.pause=function(){a.setState({pauseDisabled:!0,playDisabled:!1,stopDisabled:!1}),a.cancelSimulation=!0},a.stop=function(){a.setState({pauseDisabled:!0,playDisabled:!1,stopDisabled:!0}),a.props.jobs.removeJob(a.jobId),a.jobId=-1,a.props.tracerMaster.excite("S2",a.state.rays)},a.closeHandler=function(){a.setState({showResults:!1})},a.raysChanged=function(e,t){a.setState({rays:e})},a.state={pauseDisabled:!0,playDisabled:!1,progress:0,rays:1e3,result:null,showResults:!1,stopDisabled:!0},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"initRays",value:function(e){this.raysSAB=e,this.rayGroup&&this.props.scene.remove(this.rayGroup),this.rayGroup=new p.Group;for(var t=0;t<20;t++){var a=e[t],r=new p.BufferGeometry;this.rayGeometries.push(r);var n=new Float32Array(a,0,4e3);r.addAttribute("position",new p.BufferAttribute(n,4)),r.setDrawRange(0,2);var i=new p.Line(r);this.rayGroup.add(i)}this.props.scene.add(this.rayGroup)}},{key:"render",value:function(){return[n.a.createElement(ge,{key:"parent",name:"SimulationController",hideTitleBar:!0,width:150,height:30,maxHeight:30,minWidth:180,cancel:".bp3-input",className:"simulation-controller"},n.a.createElement(Q.a,null,n.a.createElement(ee.a,{min:12,max:1e5,stepSize:1e3,majorStepSize:1e4,minorStepSize:100,value:this.state.rays,selectAllOnFocus:!0,clampValueOnBlur:!0,onValueChange:this.raysChanged}),n.a.createElement(te.b,{disabled:this.state.playDisabled,icon:"play",onClick:this.play,title:"Play"}),n.a.createElement(te.b,{disabled:this.state.pauseDisabled,icon:"pause",onClick:this.pause,title:"Pause"}),n.a.createElement(te.b,{disabled:this.state.stopDisabled,icon:"stop",onClick:this.stop,title:"Stop"}))),this.results()]}},{key:"results",value:function(){return this.state.showResults?n.a.createElement(Se,{name:"Simulation Results",simulationStats:this.state.simulationStats,onClose:this.closeHandler,isOpen:this.state.showResults}):[]}}]),t}(n.a.PureComponent),xe=(a(382),a(400)),ke=a(183),Me=a(68),Ce=a(399),Re=function e(t){Object(l.a)(this,e),this.model=t,this.volume=void 0,this.surface=void 0,this.materialStats=void 0,this.floorArea=0;for(var a=t.surfaces,r={},n=new p.Triangle,i=0,o=0,s=a.length;o<s;o++){var c=a[o],u=c.material;void 0===r[u.name]&&(r[u.name]=0);for(var d=c.geometry,h=d.faces,m=d.vertices,f=0,b=0,v=h.length;b<v;b++){var y=h[b],g=m[y.c],w=m[y.b],E=m[y.a];i+=g.x*w.y*E.z+g.y*w.z*E.x+g.z*w.x*E.y-g.x*w.z*E.y-g.y*w.x*E.z-g.z*w.y*E.x,n.set(g,w,E),f+=n.getArea()}c.isFloor&&(this.floorArea+=f),r[u.name]+=f}this.materialStats=r,i/=6,this.volume=i;var S=Object.values(r).reduce(function(e,t){return e+t},0);this.surface=S},Ie=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,null,[{key:"estimate",value:function(e){var t=new Re(e),a=new b(20,60),r=[];return g.map(function(e){var n=0;Object.entries(t.materialStats).map(function(t){var a=Object(ie.a)(t,2),r=a[0],i=a[1],o=j.getMaterial(r).absorption.get(e)/100;n+=o*i});var i=a.get(e);r.push(.161*t.volume/(n+i*t.volume))}),console.log(r),E(r)}}]),e}(),De=function(e){function t(e){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){for(var e="M 0 100 ",t=this.props.data,a=0,r=t.length;a<r;a++){e+="L "+100*a+" "+(100-t[a])+" "}return e+=" L 500 100 z",n.a.createElement("svg",{viewBox:"0 0 500 100",xmlSpace:"preserve"},n.a.createElement("linearGradient",{id:"gradient",gradientUnits:"userSpaceOnUse",x1:384,y1:100,x2:384,y2:0},n.a.createElement("stop",{offset:0,stopColor:"#ab700b"}),n.a.createElement("stop",{offset:1,stopColor:"#fb900b"})),n.a.createElement("path",{fill:"url(#gradient)",d:e}))}}]),t}(n.a.PureComponent);a(179);me.a.registerTheme("dark",be);var Pe=function(e){function t(e){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return n.a.createElement(de.a,{echarts:me.a,option:this.getOptions(this.props.modelInfo.materialStats),theme:"dark",opts:{renderer:"svg"},style:{width:"100%",height:"250px"}})}},{key:"getOptions",value:function(e){return{backgroundColor:"#2c343c",title:{text:"Customized Pie",left:"center",top:20,textStyle:{color:"#ccc"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},visualMap:[{show:!1,min:80,max:600,inRange:{colorLightness:[0,1]}}],series:[{name:"Material Distribution",type:"pie",radius:"55%",center:["50%","50%"],data:Object.entries(e).map(function(e){return Object.assign({},{name:e[0]},{value:Math.round(e[1])})}).sort(function(e,t){return e.value-t.value}),roseType:!1,label:{normal:{textStyle:{color:"rgba(255, 255, 255, 0.3)"}}},labelLine:{normal:{lineStyle:{color:"rgba(255, 255, 255, 0.3)"},smooth:.2,length:10,length2:20}},itemStyle:{normal:{color:"#c23531",shadowBlur:200,shadowColor:"rgba(0, 0, 0, 0.5)"}},animationType:"scale",animationEasing:"elasticOut",animationDelay:function(){return 200*Math.random()}}]}}}]),t}(n.a.PureComponent),Le=a(84),Ae=a(22),Ve=function(e){function t(e){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=0;if("auto"===this.props.precision){var t=Math.abs(this.props.value);t<10?e=2:t<50&&(e=1)}else e=this.props.precision;var a=(+this.props.value.toFixed(e)).toString();if(!0!==this.props.omitUnit)switch(this.props.unit){case"m3":a+=" m\xb3";break;case"m2":a+=" m\xb2";break;default:a+=" "+this.props.unit}return n.a.createElement(Le.a,{className:Ae.a.TOOLTIP_INDICATOR,content:this.props.value.toString()},n.a.createElement("span",null,a))}}]),t}(n.a.PureComponent);Ve.defaultProps={precision:"auto"},me.a.registerTheme("dark",be);var Te,Be=function(e){function t(e){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).call(this,e))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return n.a.createElement(de.a,{echarts:me.a,option:this.getOptions(),theme:"dark",opts:{renderer:"svg"},style:{width:"100%",height:"250px"}})}},{key:"getOptions",value:function(){return{title:{text:"RT"},tooltip:{trigger:"axis"},grid:{bottom:"3%",containLabel:!0,left:"3%",right:"4%"},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:["125 Hz","250 Hz","500 Hz","1 kHz","2 kHz","4 kHz"]},yAxis:{type:"value"},series:[{data:this.props.rt,name:"before",type:"line"}]}}}]),t}(n.a.PureComponent),Ne=(a(392),Ce.a.ofType());!function(e){e[e.A1=0]="A1",e[e.A2=1]="A2",e[e.A3=2]="A3",e[e.A4=3]="A4",e[e.A5=4]="A5",e[e.B1=5]="B1",e[e.B2=6]="B2",e[e.B3=7]="B3",e[e.B4=8]="B4",e[e.B5=9]="B5"}(Te||(Te={}));var ze=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).name="DIN 18041:2016",a.testClick=function(){a.props.validate(!1)},a.roomRenderer=function(e,t){return n.a.createElement(le.a,{active:t.modifiers.active,disabled:t.modifiers.disabled,key:e.cateogry,text:n.a.createElement("div",null,e.description," and ",n.a.createElement("ul",null,e.examples.map(function(e){return n.a.createElement("li",null,e)}))),onClick:t.handleClick})},a.roomSelect=function(e){switch(console.log("room select",e),a.setState({activeRoom:e}),e.cateogry){case Te.A1:case Te.A2:break;default:console.log("unknown room category")}},a.state={activeRoom:t.RoomTypes[0]},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"renderOptions",value:function(){throw new Error("Method not implemented.")}},{key:"renderGraph",value:function(){throw new Error("Method not implemented.")}}]),Object(c.a)(t,[{key:"render",value:function(){return console.log("standard options re-render"),n.a.createElement("tr",null,n.a.createElement("td",null,"Usage"),n.a.createElement("td",null,n.a.createElement(Ne,{items:t.RoomTypes,itemRenderer:this.roomRenderer,onItemSelect:this.roomSelect},n.a.createElement(te.b,{text:this.state.activeRoom.description,rightIcon:"double-caret-vertical"}))))}},{key:"componentWillReceiveProps",value:function(){console.log("recv props")}}]),t}(n.a.PureComponent);ze.RoomTypes=[{cateogry:Te.A1,description:"Music",examples:["court","mourt","zourt"]},{cateogry:Te.A2,description:"borem tupsum",examples:["tourt","pourt","yourt"]},{cateogry:Te.A3,description:"borem tupsum",examples:["tourt","pourt","yourt"]},{cateogry:Te.A4,description:"borem tupsum",examples:["tourt","pourt","yourt"]},{cateogry:Te.A5,description:"borem tupsum",examples:["tourt","pourt","yourt"]},{cateogry:Te.B1,description:"Borem tupsum",examples:["tourt","pourt","yourt"]},{cateogry:Te.B2,description:"borem tupsum",examples:["tourt","pourt","yourt"]},{cateogry:Te.B3,description:"borem tupsum",examples:["tourt","pourt","yourt"]},{cateogry:Te.B4,description:"borem tupsum",examples:["tourt","pourt","yourt"]},{cateogry:Te.B5,description:"borem tupsum",examples:["tourt","pourt","yourt"]}];var Fe,Ge=Ce.a.ofType();!function(e){e.DIN18041="DIN 18041:2016"}(Fe||(Fe={}));var We=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).standards=[Fe.DIN18041],a.renderStandardsUI=function(){var e={model:a.state.model,rt:a.state.rt,validate:a.validate};switch(a.state.activeStandard){case Fe.DIN18041:return n.a.createElement(ze,e)}},a.testClick=function(){a.setState({rt:[Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random()]})},a.standardRenderer=function(e,t){return n.a.createElement(le.a,{active:t.modifiers.active,disabled:t.modifiers.disabled,key:e,text:e,onClick:t.handleClick})},a.standardSelect=function(e){a.setState({activeStandard:e})},a.validate=function(e){console.log("validate",e)},a.state={activeStandard:"Please choose a standard",model:a.props.model,rt:[]},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return n.a.createElement("table",{className:"bp3-html-table bp3-html-table-condensed bp3-html-table-striped"},n.a.createElement("tbody",null,n.a.createElement("tr",null,n.a.createElement("td",null,"Standard"),n.a.createElement("td",null,n.a.createElement(Ge,{filterable:!1,items:this.standards,itemRenderer:this.standardRenderer,onItemSelect:this.standardSelect},n.a.createElement(te.b,{text:this.state.activeStandard,rightIcon:"double-caret-vertical"})),"\xa0",n.a.createElement("a",{href:"mailto:?subject=New Standard Request",className:"bp3-text-small"},"Request a new standard"))),this.renderStandardsUI()))}}]),t}(n.a.PureComponent),He=Ce.a.ofType(),qe=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={randomRT:[]},a.filterMaterial2=function(e,t){return Object.values(j.materials).filter(function(t){return t.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>=0})},a.filterMaterial=function(e,t,a,r){return console.log("item predicate"),t.name.toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>=0},a.itemRenderer=function(e,t){return t.modifiers.matchesPredicate?n.a.createElement(le.a,{active:t.modifiers.active,disabled:t.modifiers.disabled,key:e.name,onClick:t.handleClick,text:n.a.createElement("div",{className:"material-select"},n.a.createElement("div",null,e.name),n.a.createElement(De,{data:e.absorption.values}))}):null},a.itemSelect=function(e,t){console.log("item select",e,t)},a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;if(null===this.props.model)return n.a.createElement("div",null);var t=new Re(this.props.model);return n.a.createElement(ge,{name:"Sabine",icon:"bp3-icon-series-search",dragHandleClassName:"bp3-dialog-header"},n.a.createElement(ke.a,{animate:!1},n.a.createElement(Me.a,{id:"rt",title:"Reverberation",panel:n.a.createElement(Be,{rt:Ie.estimate(this.props.model).values})}),n.a.createElement(Me.a,{id:"md",title:"Materials",panel:n.a.createElement(Pe,{modelInfo:t})})),n.a.createElement("div",{className:"secondary-body"},n.a.createElement(We,{model:this.props.model}),n.a.createElement("table",{className:"bp3-html-table bp3-html-table-condensed bp3-html-table-striped"},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Metric"),n.a.createElement("th",null,"Value"))),n.a.createElement("tbody",null,n.a.createElement("tr",null,n.a.createElement("td",null,"Volume"),n.a.createElement("td",null,n.a.createElement(Ve,{value:t.volume,unit:"m3"}))),n.a.createElement("tr",null,n.a.createElement("td",null,"Surfrace area"),n.a.createElement("td",null,n.a.createElement(Ve,{value:t.surface,unit:"m2"}))),n.a.createElement("tr",null,n.a.createElement("td",null,"Mean height"),n.a.createElement("td",null,n.a.createElement(Ve,{value:t.volume/t.floorArea,unit:"m"}))))),n.a.createElement("table",{className:"bp3-html-table bp3-html-table-condensed bp3-html-table-striped bp3-fill"},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"Structure"),n.a.createElement("th",null,"Area (m\xb2)"),n.a.createElement("th",null,"Materiall"))),n.a.createElement("tbody",null,Object.entries(t.materialStats).map(function(t){return n.a.createElement("tr",{key:t[0]},n.a.createElement("td",null,t[0]),n.a.createElement("td",null,n.a.createElement(Ve,{value:t[1],unit:"m2",omitUnit:!0})),n.a.createElement("td",null,n.a.createElement(He,{items:Object.values(j.materials),itemRenderer:e.itemRenderer,onItemSelect:function(a){return e.itemSelect(t[0],a)},itemPredicate:e.filterMaterial,itemListPredicate:e.filterMaterial2,popoverProps:{}},n.a.createElement(te.b,{text:"Select a material",rightIcon:"double-caret-vertical"}))))})))))}}]),t}(n.a.PureComponent),Ue=function(e){function t(e,a){var r;return Object(l.a)(this,t),(r=Object(u.a)(this,Object(d.a)(t).call(this,e,a))).isSelectable=!0,r.normalMaterial=void 0,r.selected=!1,r.highlighted=!1,r.normalMaterial=a,r}return Object(h.a)(t,e),Object(c.a)(t,[{key:"highlight",value:function(){!0!==this.highlighted&&(this.highlighted=!0,this.update())}},{key:"unhighlight",value:function(){!1!==this.highlighted&&(this.highlighted=!1,this.update())}},{key:"select",value:function(){!0!==this.selected&&(this.selected=!0,this.update())}},{key:"unselect",value:function(){!1!==this.selected&&(this.selected=!1,this.update())}},{key:"toggleSelect",value:function(){this.selected=!this.selected,this.update()}},{key:"update",value:function(){this.selected?this.material=t.SELECT_MATERIAL:this.highlighted?this.material=t.HIGHLIGHT_MATERIAL:this.material=this.normalMaterial}}]),t}(p.Mesh);Ue.HIGHLIGHT_MATERIAL=new p.MeshBasicMaterial({color:16711680}),Ue.SELECT_MATERIAL=new p.MeshBasicMaterial({color:16711935});var Je=function(e){function t(e,a){return Object(l.a)(this,t),Object(u.a)(this,Object(d.a)(t).call(this,e,a))}return Object(h.a)(t,e),t}(Ue),_e=a(393)(p),$e=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).airAbsorption=new b(20,50),a.tracerMaster=void 0,a.renderer=void 0,a.frameId=void 0,a.scene=void 0,a.camera=void 0,a.controls=void 0,a.ref=void 0,a.contextTarget=void 0,a.contextMenu=void 0,a.stats=void 0,a.rayGroup=new p.Group,a.sources={},a.receivers={},a.odds=0,a.rays=[],a.rayGeometries=[],a.chartData=[],a.jobsRef=void 0,a.order=0,a.reflectogramViews=[],a.rayCaster=void 0,a.mouse=new p.Vector2,a.surfaces=[],a.intersected=null,a.lastModelTimestamp="",a.modelGroup=new p.Group,a.activeMaterials=[],a.componentDidMount=function(){window.addEventListener("focus",a.focus),window.addEventListener("resize",a.updateDimensions),a.ref.current.appendChild(a.renderer.domElement),a.renderer.domElement.addEventListener("mousemove",a.onCanvasMouseMove,!1),a.renderer.domElement.addEventListener("contextmenu",a.onCanvasContextMenu,!1),a.renderer.domElement.addEventListener("click",a.onCanvasClick,!1),a.start(),a.forceUpdate()},a.start=function(){a.frameId||(a.frameId=requestAnimationFrame(a.animate))},a.stop=function(){cancelAnimationFrame(a.frameId)},a.receiverUpdate=function(e){console.log(e),a.setState({receivers:e})},a.iterationCompleted=function(){console.log("itereation completed")},a.render=function(){return n.a.createElement("div",{className:"bp3-dark"},n.a.createElement(Z,{ref:a.jobsRef}),n.a.createElement("div",{ref:a.ref,onClick:function(e){return a.setState({popoverShow:!1})}}),n.a.createElement("div",{className:"HUD"},n.a.createElement(Oe,{onIterationComplete:a.iterationCompleted,tracerMaster:a.tracerMaster,scene:a.scene,jobs:a.jobsRef.current}),n.a.createElement(oe.a,{isOpen:a.state.popoverShow,usePortal:!0},n.a.createElement("div",{style:{position:"absolute"},ref:a.contextTarget}),n.a.createElement("div",{onClick:function(e){return e.stopPropagation()},style:{position:"absolute"},ref:a.contextMenu}))),n.a.createElement(qe,{model:a.state.model}))},a.renderScene=function(){a.renderer.render(a.scene,a.camera)},a.animate=function(){a.frameId=window.requestAnimationFrame(a.animate),a.odds++%2!==0&&(a.highlight(),a.renderScene(),a.stats.update())},a.updateDimensions=function(){a.camera.aspect=window.innerWidth/window.innerHeight,a.camera.updateProjectionMatrix(),a.renderer.setSize(window.innerWidth,window.innerHeight)},a.onCanvasMouseMove=function(e){a.mouse.x=e.clientX/window.innerWidth*2-1,a.mouse.y=-e.clientY/window.innerHeight*2+1},a.onCanvasClick=function(e){null!==a.intersected&&(a.intersected.toggleSelect(),console.log(a.intersected))},a.onCanvasContextMenu=function(e){e.preventDefault(),xe.a.show(a.generateMenu(),{left:e.clientX,top:e.clientY},function(){},!0)},a.focus=function(){navigator.clipboard.readText().then(function(e){if(e.startsWith("###EAAS$$$")){var t=e.substr("###EAAS$$$".length,13);if(t===a.lastModelTimestamp)return;a.lastModelTimestamp=t;var r=e.substr("###EAAS$$$".length+13),n=JSON.parse(r);a.loadModel(n)}})},a.renderer=new p.WebGLRenderer({antialias:!(window.devicePixelRatio>1)}),a.renderer.setPixelRatio(window.devicePixelRatio),a.renderer.setSize(window.innerWidth,window.innerHeight),p.Object3D.DefaultUp.set(0,0,1),a.scene=new p.Scene,a.scene.background=new p.Color(0),a.camera=new p.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,9999999),a.controls=new _e(a.camera,a.renderer.domElement),a.stats=new f.a,a.ref=n.a.createRef(),a.contextTarget=n.a.createRef(),a.contextMenu=n.a.createRef(),a.jobsRef=n.a.createRef(),a.frameId=0,a.airAbsorption=new b(24,58),a.tracerMaster=new _,a.camera.position.x=32,a.camera.position.y=32,a.camera.position.z=32,a.controls.update(),a.initLights(),a.initGuides(),a.state={data:{drawCount:1e3,drawFrom:0,orderCount:1,orderFrom:0,rays:1e3},dialogs:[],receivers:{},reflectogram:[],diffMap:[],reflectogramAggregator:new G([]),cancelSimulation:!1,toaster:void 0,iteration:1e3,popoverShow:!1,surfaces:a.surfaces,model:null},a.scene.add(a.modelGroup),a.rayCaster=new p.Raycaster,a.focus(),a}return Object(h.a)(t,e),Object(c.a)(t,[{key:"addSurface",value:function(e){this.surfaces.push(e),this.modelGroup.add(new Je(e.geometry,e.material))}},{key:"modelInit",value:function(){this.surfaces=[]}},{key:"modelDone",value:function(){}},{key:"addReceiver",value:function(e){var a=new p.SphereBufferGeometry(.5,8,8),r=new Ue(a,t.receiverMaterial);r.position.copy(e.center),r.updateMatrix(),r.updateMatrixWorld(),this.modelGroup.add(r),this.receivers[e.name]=r,this.chartData.push([])}},{key:"addSource",value:function(e){var a=new p.SphereBufferGeometry(.1,8,8),r=new Ue(a,t.sourceMaterial);r.position.copy(e.position.clone()),r.updateMatrix(),r.updateMatrixWorld(),this.sources[e.name]=r,this.modelGroup.add(r)}},{key:"loadModel",value:function(e){this.activeMaterials=[],this.tracerMaster.setEnvironment(24,58),this.tracerMaster.loadModel(e),this.scene.remove(this.modelGroup),this.modelGroup=new p.Group,this.scene.add(this.modelGroup),this.sources={},this.receivers={},this.surfaces=[];var t=F.load(e,this);this.setState({model:t})}},{key:"highlight",value:function(){this.rayCaster.setFromCamera(this.mouse,this.camera);var e=this.rayCaster.intersectObjects(this.modelGroup.children);if(e.length>0){if(this.intersected!==e[0].object){if(void 0===e[0].object.isSelectable)return;null!==this.intersected&&this.intersected.unhighlight(),this.intersected=e[0].object,this.intersected.highlight()}}else null!==this.intersected&&this.intersected.unhighlight(),this.intersected=null}},{key:"initLights",value:function(){var e=new p.AmbientLight(16777215,.5);this.scene.add(e);var t=[new p.PointLight(16777215,.5,0),new p.PointLight(16777215,.5,0),new p.PointLight(16777215,1,0)];t[0].position.set(0,200,0),t[1].position.set(100,200,1e3),t[2].position.set(-100,-200,1e3),this.scene.add(t[0]),this.scene.add(t[1]),this.scene.add(t[2])}},{key:"initGuides",value:function(){var e=this;function t(t,a,r){var n=new p.LineDashedMaterial({color:r}),i=new p.Geometry;i.vertices.push(t),i.vertices.push(a),e.scene.add(new p.Line(i,n))}t(new p.Vector3(0,0,0),new p.Vector3(1e4,0,0),16711680),t(new p.Vector3(-1e4,0,0),new p.Vector3(0,0,0),16742263),t(new p.Vector3(0,0,0),new p.Vector3(0,1e4,0),65280),t(new p.Vector3(0,-1e4,0),new p.Vector3(0,0,0),8978312),t(new p.Vector3(0,0,0),new p.Vector3(0,0,1e4),255),t(new p.Vector3(0,0,-1e4),new p.Vector3(0,0,0),7829503)}},{key:"generateMenu",value:function(){return n.a.createElement(se.a,{key:"menu"},n.a.createElement(ce.a,{title:"Edit"}),n.a.createElement(le.a,{icon:"cut",text:"Cut",label:"\u2318X"}),n.a.createElement(le.a,{icon:"duplicate",text:"Copy",label:"\u2318C"}),n.a.createElement(le.a,{icon:"clipboard",text:"Paste",label:"\u2318V",disabled:!0}),n.a.createElement(ce.a,{title:"Text"}),n.a.createElement(le.a,{icon:"align-left",text:"Alignment"},n.a.createElement(le.a,{icon:"align-left",text:"Left"}),n.a.createElement(le.a,{icon:"align-center",text:"Center"}),n.a.createElement(le.a,{icon:"align-right",text:"Right"}),n.a.createElement(le.a,{icon:"align-justify",text:"Justify"})),n.a.createElement(le.a,{icon:"style",text:"Style"},n.a.createElement(le.a,{icon:"bold",text:"Bold"}),n.a.createElement(le.a,{icon:"italic",text:"Italic"}),n.a.createElement(le.a,{icon:"underline",text:"Underline"})))}}]),t}(n.a.Component);$e.receiverMaterial=new p.MeshPhongMaterial({color:5616265,emissive:468276,flatShading:!0,vertexColors:p.VertexColors,wireframe:!1}),$e.sourceMaterial=new p.MeshPhongMaterial({color:16065049,emissive:468276,flatShading:!0,vertexColors:p.VertexColors,wireframe:!1});a(395);o.a.render(n.a.createElement(s.AppContainer,null,n.a.createElement($e,null)),document.getElementById("view")),console.log("no hot support")},59:function(e){e.exports={color:["#dd6b66","#759aa0","#e69d87","#8dc1a9","#ea7e53","#eedd78","#73a373","#73b9bc","#7289ab","#91ca8c","#f49f42"],backgroundColor:"#1a1a1a",textStyle:{},title:{textStyle:{color:"#eeeeee"},subtextStyle:{color:"#aaaaaa"}},line:{itemStyle:{normal:{borderWidth:1}},lineStyle:{normal:{width:2}},symbolSize:4,symbol:"circle",smooth:!1},radar:{itemStyle:{normal:{borderWidth:1}},lineStyle:{normal:{width:2}},symbolSize:4,symbol:"circle",smooth:!1},bar:{itemStyle:{normal:{barBorderWidth:0,barBorderColor:"#ccc"},emphasis:{barBorderWidth:0,barBorderColor:"#ccc"}}},pie:{itemStyle:{normal:{borderWidth:0,borderColor:"#ccc"},emphasis:{borderWidth:0,borderColor:"#ccc"}}},scatter:{itemStyle:{normal:{borderWidth:0,borderColor:"#ccc"},emphasis:{borderWidth:0,borderColor:"#ccc"}}},boxplot:{itemStyle:{normal:{borderWidth:0,borderColor:"#ccc"},emphasis:{borderWidth:0,borderColor:"#ccc"}}},parallel:{itemStyle:{normal:{borderWidth:0,borderColor:"#ccc"},emphasis:{borderWidth:0,borderColor:"#ccc"}}},sankey:{itemStyle:{normal:{borderWidth:0,borderColor:"#ccc"},emphasis:{borderWidth:0,borderColor:"#ccc"}}},funnel:{itemStyle:{normal:{borderWidth:0,borderColor:"#ccc"},emphasis:{borderWidth:0,borderColor:"#ccc"}}},gauge:{itemStyle:{normal:{borderWidth:0,borderColor:"#ccc"},emphasis:{borderWidth:0,borderColor:"#ccc"}}},candlestick:{itemStyle:{normal:{color:"#fd1050",color0:"#0cf49b",borderColor:"#fd1050",borderColor0:"#0cf49b",borderWidth:1}}},graph:{itemStyle:{normal:{borderWidth:0,borderColor:"#ccc"}},lineStyle:{normal:{width:1,color:"#aaaaaa"}},symbolSize:4,symbol:"circle",smooth:!1,color:["#dd6b66","#759aa0","#e69d87","#8dc1a9","#ea7e53","#eedd78","#73a373","#73b9bc","#7289ab","#91ca8c","#f49f42"],label:{normal:{textStyle:{color:"#eeeeee"}}}},map:{itemStyle:{normal:{areaColor:"#eeeeee",borderColor:"#444444",borderWidth:.5},emphasis:{areaColor:"rgba(255,215,0,0.8)",borderColor:"#444444",borderWidth:1}},label:{normal:{textStyle:{color:"#000000"}},emphasis:{textStyle:{color:"rgb(100,0,0)"}}}},geo:{itemStyle:{normal:{areaColor:"#eeeeee",borderColor:"#444444",borderWidth:.5},emphasis:{areaColor:"rgba(255,215,0,0.8)",borderColor:"#444444",borderWidth:1}},label:{normal:{textStyle:{color:"#000000"}},emphasis:{textStyle:{color:"rgb(100,0,0)"}}}},categoryAxis:{axisLine:{show:!0,lineStyle:{color:"#eeeeee"}},axisTick:{show:!0,lineStyle:{color:"#eeeeee"}},axisLabel:{show:!0,textStyle:{color:"#eeeeee"}},splitLine:{show:!0,lineStyle:{color:["#aaaaaa"]}},splitArea:{show:!1,areaStyle:{color:["#eeeeee"]}}},valueAxis:{axisLine:{show:!0,lineStyle:{color:"#eeeeee"}},axisTick:{show:!0,lineStyle:{color:"#eeeeee"}},axisLabel:{show:!0,textStyle:{color:"#eeeeee"}},splitLine:{show:!0,lineStyle:{color:["#aaaaaa"]}},splitArea:{show:!1,areaStyle:{color:["#eeeeee"]}}},logAxis:{axisLine:{show:!0,lineStyle:{color:"#eeeeee"}},axisTick:{show:!0,lineStyle:{color:"#eeeeee"}},axisLabel:{show:!0,textStyle:{color:"#eeeeee"}},splitLine:{show:!0,lineStyle:{color:["#aaaaaa"]}},splitArea:{show:!1,areaStyle:{color:["#eeeeee"]}}},timeAxis:{axisLine:{show:!0,lineStyle:{color:"#eeeeee"}},axisTick:{show:!0,lineStyle:{color:"#eeeeee"}},axisLabel:{show:!0,textStyle:{color:"#eeeeee"}},splitLine:{show:!0,lineStyle:{color:["#aaaaaa"]}},splitArea:{show:!1,areaStyle:{color:["#eeeeee"]}}},toolbox:{iconStyle:{normal:{borderColor:"#999999"},emphasis:{borderColor:"#666666"}}},legend:{textStyle:{color:"#eeeeee"}},tooltip:{axisPointer:{lineStyle:{color:"#eeeeee",width:"1"},crossStyle:{color:"#eeeeee",width:"1"}}},timeline:{lineStyle:{color:"#eeeeee",width:1},itemStyle:{normal:{color:"#dd6b66",borderWidth:1},emphasis:{color:"#a9334c"}},controlStyle:{normal:{color:"#eeeeee",borderColor:"#eeeeee",borderWidth:.5},emphasis:{color:"#eeeeee",borderColor:"#eeeeee",borderWidth:.5}},checkpointStyle:{color:"#e43c59",borderColor:"rgba(194,53,49,0.5)"},label:{normal:{textStyle:{color:"#eeeeee"}},emphasis:{textStyle:{color:"#eeeeee"}}}},visualMap:{color:["#bf444c","#d88273","#f6efa6"]},dataZoom:{backgroundColor:"rgba(47,69,84,0)",dataBackgroundColor:"rgba(255,255,255,0.3)",fillerColor:"rgba(167,183,204,0.4)",handleColor:"#a7b7cc",handleSize:"100%",textStyle:{color:"#eeeeee"}},markPoint:{label:{normal:{textStyle:{color:"#eeeeee"}},emphasis:{textStyle:{color:"#eeeeee"}}}}}}},[[237,1,2]]]);
//# sourceMappingURL=main.064c9691.chunk.js.map